<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.secondproject.teacher.subject.SubjectMapper">


    <select id="subCate" resultType="SubjectVo">
        SELECT category_id categoryid,nm
        FROM sbj_category
        WHERE TYPE = 1
    </select>

    <select id="subject">
        select DISTINCT A.subject_id subjectid ,A.nm ,A.category_id categoryid FROM
        subject A
        INNER JOIN sbj_category B
        ON A.category_id = B.category_id
        WHERE B.`type` =1 and A.category_id = #{categoryid};
    </select>
    <select id="tcslist" resultType="SubjectDetailVo2">
        SELECT DISTINCT B.subject_id subjectid,A.nm,C.user_id userid
        FROM sbj_category A
        INNER JOIN subject B
        ON A.category_id = B.category_id
        INNER JOIN sc_sbj C
        ON B.subject_id = C.subject_id
        INNER JOIN user D
        ON C.user_id = D.user_id
        WHERE A.`type`= 1 AND C.user_id = #{userid} and D.apr_yn = 1
        group BY A.nm

    </select>
    <select id="smalllist" resultType="SubjectVo2">
        SELECT A.subject_id subjectId,A.nm,B.user_id userId FROM subject A
        INNER JOIN sc_sbj B
        ON A.subject_id = B.subject_id
        INNER JOIN `user` C
        ON C.user_id = B.user_id
        WHERE B.user_id = #{userId} AND A.category_id = #{category_id};
    </select>
    <select id="classnum">
        SELECT COUNT(C.van_id) vanId FROM van A
        INNER JOIN school B
        ON A.school_id = B.school_id
        INNER JOIN user C
        ON A.van_id = C.van_id
        WHERE C.van_id = #{vanId} AND C.role_type ="STD" AND C.apr_yn = 1
    </select>

    <select id="schoolnum">
        SELECT COUNT(B.nm) * 14 nm FROM van A
        INNER JOIN school B
        ON A.school_id = B.school_id
        INNER JOIN user C
        ON A.van_id = C.van_id
        WHERE A.grade = #{grade} AND C.role_type ="STD" AND C.apr_yn = 1
    </select>

    <select id="mockbiglist" resultType="MockSubjectBigVo">
        SELECT DISTINCT B.category_id categoryid,B.nm
        from subject A
        INNER JOIN sbj_category B
        ON A.category_id = B.category_id
        WHERE B.`type` = 2
    </select>

<!--    <select id="mocksmalllist">-->
<!--        SELECT A.subject_id subjectid ,A.nm ,A.category_id categoryid FROM subject A-->
<!--        INNER JOIN sbj_category B-->
<!--        ON A.category_id = B.category_id-->
<!--        WHERE B.`type` = 2 AND A.category_id = #{categoryid}-->
<!--    </select>-->

    <insert id="instcsbj">
        INSERT INTO sc_sbj
        (user_id,subject_id)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.userid},#{item.subjectid})
        </foreach>
    </insert>

<!--    <select id="stulist">-->
<!--        SELECT nm FROM user-->
<!--        WHERE role = "STD" AND class_id = #{classid}-->
<!--        and apr_yn =1 and user_id = #{userid};-->
<!--    </select>-->
    <select id="stulist">
    SELECT user_id userid,nm FROM user
    WHERE role_type = "STD" AND van_id = #{vanId}
    and apr_yn = 1 and user_id = #{userid}
    </select>

</mapper>

